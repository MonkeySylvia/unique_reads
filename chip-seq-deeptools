#use deeptools to visualize the chip-seq
# create a bigWig file for Nanog


export PATH=/programs/deeptools-3.3/bin:$PATH
export PYTHONPATH=/programs/deeptools-3.3/lib64/python3.6/site-packages:/programs/deeptools-3.3/lib/python3.6/site-packages


bamCompare -b1 sort_nanog_Aligned.out.bam \
-b2 sort_nanoginput_Aligned.out.bam \
-o nanog_bgNorm.bw \
--binSize 20 \
--normalizeUsing BPM \
--scaleFactorsMethod None \
--smoothLength 60 \
--extendReads 150 \
--centerReads \
-p 6 2> nanog_bamCompare.log &

# create a matrix for plots
computeMatrix reference-point --referencePoint TSS \
-b 1000 -a 1000 \
-R ~/chipseq/results/visualization/chr12_genes.bed \
-S /n/groups/hbctraining/chip-seq/full-dataset/bigWig/Encode_Nanog*.bw \
--skipZeros \
-o ~/chipseq/results/visualization/matrixNanog_TSS_chr12.gz \
-p 6 \
--outFileSortedRegions ~/chipseq/results/visualization/regions_TSS_chr12.bed


#plots 
plotHeatmap -m visualization/matrixPou5f1_TSS_chr12.gz \
-out visualization/figures/TSS_Pou5f1_profile-heatmap.png \
--colorMap RdBu \
--zMin -2 --zMax 2  
